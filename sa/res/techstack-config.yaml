version: "1.0.0"
description: "技术栈检测配置文件 - 基于 framework-patterns.json 扩展"

# 排除规则：排除不需要检测的文件
excludes:
  - type: "path"
    pattern: "resources/base/.*"

# 技术栈检测规则
detections:
  # ==================== Flutter ====================
  - id: "Flutter"
    name: "Flutter"
    type: "Flutter"
    confidence: 0.95
    fileRules:
      - type: "filename"
        patterns: ["libflutter\\.so$", "libapp\\.so$"]
      - type: "path"
        patterns: ["flutter_assets/.*"]
    metadataRules:
      - field: "dartVersion"
        patterns:
          - source: "content"
            pattern: "(\\d+\\.\\d+\\.\\d+) \\(stable\\)"
            captureGroup: 1
      - field: "flutterHex40"
        extractor: "extractFlutterHex40"
      - field: "flutterVersionLastModified"
        extractor: "extractFlutterVersionLastModified"
      - field: "openSourcePackages"
        extractor: "extractDartPackages"
      - field: "flutterVersion"
        patterns:
          - source: "content"
            pattern: "\"flutterVersion\":\"(\\d+\\.\\d+\\.\\d+)\""
            captureGroup: 1

  # ==================== React Native ====================
  - id: "RN_LibReact"
    name: "React Native"
    type: "RN"
    confidence: 0.95
    fileRules:
      - type: "filename"
        patterns: ["libreact_.*\\.so$","libreact_.*\\.so", "librnoh\\.so", "librnoh_.*\\.so", "libjsi\\.so", "libjsinspector\\.so"]

  - id: "RN_Bundles"
    name: "RN Bundles"
    type: "RN"
    confidence: 0.90
    fileRules:
      # Hermes字节码文件 (.hbc) 或 JS bundle 文件
      - type: "extension"
        extensions: ["hbc", "jsbundle"]
      # Hermes字节码魔术字节 (0xc2 0x1f 0xf0 0x9f)
      - type: "combined"
        operator: "or"
        rules:
          - type: "extension"
            extensions: ["bundle", "js"]
          - type: "magic"
            magicBytes: [0xc2, 0x1f, 0xf0, 0x9f]
      # CTZ压缩文件 (trip魔术字节)
      - type: "combined"
        operator: "and"
        rules:
          - type: "extension"
            extensions: ["ctz"]
          - type: "magic"
            magicBytes: [0x74, 0x72, 0x69, 0x70]
    metadataRules:
      # 示例：从文件名提取bundle类型
      - field: "bundleType"
        patterns:
          - source: "filename"
            pattern: "\\.(hbc|jsbundle|bundle|js|ctz)$"
            captureGroup: 1
            transform: "lowercase"

  # ==================== Hermes ====================
  - id: "Hermes_Engine"
    name: "Hermes JavaScript Engine"
    type: "RN"
    confidence: 0.95
    fileRules:
      - type: "filename"
        patterns: ["libhermes\\.so$"]

  # ==================== KMP (Kotlin Multiplatform) ====================
  - id: "KMP_LibKn"
    name: "Kotlin Multiplatform"
    type: "KMP"
    confidence: 0.90
    fileRules:
      - type: "combined"
        operator: "and"
        rules:
          - type: "filename"
            patterns: [".*\\.so$"]
          - type: "content"
            patterns: ["kfun:", "Kotlin", "kotlin", "KOTLIN_NATIVE"]
    metadataRules:
      - field: "kotlinSignatures"
        extractor: "extractKotlinSignatures"

  # ==================== CMP (Compose Multiplatform) ====================
  - id: "CMP_Skiko"
    name: "Compose Multiplatform"
    type: "KMP"
    confidence: 0.95
    fileRules:
      - type: "filename"
        patterns: ["libskikobridge\\.so$"]

  # ==================== Lynx ====================
  - id: "Lynx_Framework"
    name: "Lynx Framework"
    type: "Lynx"
    confidence: 0.95
    fileRules:
      - type: "filename"
        patterns: ["liblynx.*\\.so$"]

  # ==================== Qt ====================
  - id: "Qt_Framework"
    name: "Qt Framework"
    type: "Qt"
    confidence: 0.95
    fileRules:
      - type: "filename"
        patterns: ["libQt.*\\.so$"]

  # ==================== Unity ====================
  - id: "Unity_Engine"
    name: "Unity Game Engine"
    type: "Unity"
    confidence: 0.95
    fileRules:
      - type: "filename"
        patterns: ["libunity\\.so$", "libil2cpp\\.so$"]

  # ==================== Taro ====================
  - id: "Taro_Framework"
    name: "Taro Framework"
    type: "Taro"
    confidence: 0.95
    fileRules:
      - type: "filename"
        patterns:
          - "libJDSilkTaroNativeOH\\.so$"
          - "libSilkTaroKit\\.so$"
          - "libtaro_native_core\\.so$"
          - "libTaroHarmonyLibrary\\.so$"
          - "libsilktaronativelib\\.so$"

  # ==================== Weex ====================
  - id: "Weex_Framework"
    name: "Weex Framework"
    type: "Weex"
    confidence: 0.95
    fileRules:
      - type: "filename"
        patterns: ["libweex_ability\\.so$", "libweex_framework\\.so$"]
