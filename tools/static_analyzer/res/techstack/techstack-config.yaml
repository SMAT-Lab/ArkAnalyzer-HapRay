version: "1.0.0"
description: "技术栈检测配置文件 - 基于 framework-patterns.json 扩展"

# 二进制魔数配置（可根据需要扩展/修改）
binaryMagicNumbers:
  # ELF (Linux 可执行文件/库)
  - bytes: [127, 69, 76, 70]
    offset: 0

  # PE (Windows 可执行文件)
  - bytes: [77, 90]
    offset: 0

  # Mach-O (macOS 可执行文件) - 32 位
  - bytes: [254, 237, 250, 206]
    offset: 0
  - bytes: [206, 250, 237, 254]
    offset: 0

  # Mach-O (macOS 可执行文件) - 64 位
  - bytes: [254, 237, 250, 207]
    offset: 0
  - bytes: [207, 250, 237, 254]
    offset: 0

  # ZIP/JAR/APK/HAP
  - bytes: [80, 75, 3, 4]
    offset: 0
  - bytes: [80, 75, 5, 6]
    offset: 0

  # PNG
  - bytes: [137, 80, 78, 71, 13, 10, 26, 10]
    offset: 0

  # JPEG
  - bytes: [255, 216, 255]
    offset: 0

  # GIF
  - bytes: [71, 73, 70, 56]
    offset: 0

  # PDF
  - bytes: [37, 80, 68, 70]
    offset: 0

  # Java Class 文件
  - bytes: [202, 254, 186, 190]
    offset: 0

  # DEX 文件
  - bytes: [100, 101, 120, 10]
    offset: 0

# 排除规则：排除不需要检测的文件
excludes:
  - type: "path"
    pattern: "resources/base/.*"

# 技术栈检测规则
detections:
  # ==================== SO Files ====================
  - id: "SO_Files"
    name: "SO Files"
    type: "SO"
    confidence: 0.90
    fileRules:
      - type: "filename"
        patterns: [".*\\.so$"]
    metadataRules:
      - field: "soDependencies"
        extractor: "extractSoDependencies"
      - field: "soExports"
        extractor: "extractSoExports"
      - field: "soImports"
        extractor: "extractSoImports"
        
  # ==================== Flutter ====================
  - id: "Flutter"
    name: "Flutter"
    type: "Flutter"
    confidence: 0.95
    requireMetadata: true  # 必须至少获取到一个metadata信息
    fileRules:
      - type: "filename"
        patterns: ["libflutter\\.so$", "libapp\\.so$"]
    metadataRules:
      - field: "dartVersion"
        patterns:
          - source: "content"
            pattern: "(\\d+\\.\\d+\\.\\d+) \\(stable\\)"
            captureGroup: 1
      - field: "Key"
        extractor: "extractFlutterHex40"
      - field: "flutterVersionLastModified"
        extractor: "extractFlutterVersionLastModified"
      - field: "openSourcePackages"
        extractor: "extractDartPackages"


  - id: "FlutterAssets"
    name: "Flutter Assets"
    type: "Flutter"
    confidence: 0.95
    requireMetadata: false  # 不要求metadata，仅基于文件路径匹配
    fileRules:
      - type: "path"
        patterns: ["flutter_assets/.*"]
    metadataRules:
      - field: "flutterVersion"
        patterns:
          - source: "content"
            pattern: "\"flutterVersion\":\"(\\d+\\.\\d+\\.\\d+)\""
            captureGroup: 1

  # ==================== React Native ====================
  - id: "RN_LibReact"
    name: "React Native"
    type: "RN"
    confidence: 0.95
    fileRules:
      - type: "filename"
        patterns: ["libreact_.*\\.so$","libreact_.*\\.so", "librnoh\\.so", "librnoh_.*\\.so", "libjsi\\.so", "libjsinspector\\.so"]

  - id: "Hermes_Engine"
    name: "Hermes JavaScript Engine"
    type: "RN"
    confidence: 0.95
    fileRules:
      - type: "filename"
        patterns: ["libhermes\\.so$"]

  - id: "RN bundles"
    name: "RN bundles"
    type: "RN"
    confidence: 0.90
    fileRules:
      - type: "extension"
        extensions: ["hbc", "jsbundle"]
      - type: "magic"
        magicBytes: [0xc2, 0x1f, 0xf0, 0x9f]
      - type: "combined"
        operator: "and"
        rules:
          - type: "extension"
            extensions: ["ctz"]
          - type: "magic"
            magicBytes: [0x74, 0x72, 0x69, 0x70]
    #提取二进制还是文本标记
      
  # ==================== KMP (Kotlin Multiplatform) ====================
  - id: "KMP_LibKn"
    name: "Kotlin Multiplatform"
    type: "KMP"
    confidence: 0.90
    fileRules:
      - type: "combined"
        operator: "and"
        rules:
          - type: "filename"
            patterns: [".*\\.so$"]
          - type: "content"
            patterns:
              - pattern: "KOTLIN_NATIVE_AVAILABLE_PROCESSORS"
                confidence: 0.95
              - pattern: "ZN6kotlin2gc22ConcurrentMarkAndSweep"
                confidence: 0.5
              - pattern: "ZN6kotlin2gc27ParallelMarkConcurrentSweep"
                confidence: 0.5
              - pattern: "ZN6kotlin11gcScheduler11GCScheduler4ImplC1ERNS0_17GCSchedulerConfigEE3$_0"
                confidence: 0.5

  - id: "CMP_Skiko"
    name: "Compose Multiplatform"
    type: "KMP"
    confidence: 0.95
    fileRules:
      - type: "filename"
        patterns: ["libskikobridge\\.so$"]

  # ==================== Lynx ====================
  - id: "Lynx_Framework"
    name: "Lynx Framework"
    type: "Lynx"
    confidence: 0.95
    fileRules:
      - type: "filename"
        patterns: ["liblynx.*\\.so$"]

  # ==================== Qt ====================
  - id: "Qt_Framework"
    name: "Qt Framework"
    type: "Qt"
    confidence: 0.95
    fileRules:
      - type: "filename"
        patterns: ["libQt.*\\.so$"]

  # ==================== Unity ====================
  - id: "Unity_Engine"
    name: "Unity Game Engine"
    type: "Unity"
    confidence: 0.95
    fileRules:
      - type: "filename"
        patterns: ["libunity\\.so$", "libil2cpp\\.so$"]

  # ==================== Taro ====================
  - id: "Taro_Framework"
    name: "Taro Framework"
    type: "Taro"
    confidence: 0.95
    fileRules:
      - type: "filename"
        patterns:
          - "libJDSilkTaroNativeOH\\.so$"
          - "libSilkTaroKit\\.so$"
          - "libtaro_native_core\\.so$"
          - "libTaroHarmonyLibrary\\.so$"
          - "libsilktaronativelib\\.so$"

  # ==================== Weex ====================
  - id: "Weex_Framework"
    name: "Weex Framework"
    type: "Weex"
    confidence: 0.95
    fileRules:
      - type: "filename"
        patterns: ["libweex_ability\\.so$", "libweex_framework\\.so$"]

  # ==================== Cangjie (仓颉) ====================
  - id: "Cangjie_Framework"
    name: "Cangjie Framework"
    type: "Cangjie"
    confidence: 0.95
    fileRules:
      - type: "filename"
        patterns: ["libcj_.*\\.so$", "libcjhybridview\\.so$", "libcontact_cj.*\\.so$"]

  # ==================== @duke/logan ====================
  - id: "@duke/logan"
    name: "@duke/logan"
    type: "@duke/logan"
    confidence: 0.95
    fileRules:
      - type: "filename"
        patterns: ["liblogan\\.so$"]

  # ==================== LevelDB ====================
  - id: "@devzeng/leveldb"
    name: "@devzeng/leveldb"
    type: "@devzeng/leveldb"
    confidence: 0.95
    fileRules:
      - type: "filename"
        patterns: ["libleveldb\\.so$"]

  # ==================== WebSocket/Crypto ====================
  - id: "@duke/websocket-client"
    name: "@duke/websocket-client"
    type: "@duke/websocket-client"
    confidence: 0.95
    fileRules:
      - type: "filename"
        patterns: ["libwebsocketClient\\.so$"]

  # ==================== @ohos/flate2 ====================
  - id: "@ohos/flate2"
    name: "@ohos/flate2"
    type: "@ohos/flate2"
    confidence: 0.95
    fileRules:
      - type: "filename"
        patterns: ["libflate2\\.so$"]

  # ==================== @ohos/gpu_transform ====================
  - id: "GPU_Transform"
    name: "@ohos/gpu_transform"
    type: "@ohos/gpu_transform"
    confidence: 0.95
    fileRules:
      - type: "filename"
        patterns: ["libnativeGpu\\.so$"]

  # ==================== @ohos/imageknifepro ====================
  - id: "@ohos/imageknifepro"
    name: "@ohos/imageknifepro"
    type: "@ohos/imageknifepro"
    confidence: 0.95
    fileRules:
      - type: "filename"
        patterns: ["libimageknifepro\\.so$"]

  # ==================== @tencent/libpag ====================
  - id: "PAG_Framework"
    name: "@tencent/libpag"
    type: "@tencent/libpag"
    confidence: 0.95
    fileRules:
      - type: "filename"
        patterns: ["libpag\\.so$", "libnative_libpag\\.so$"]

  # ==================== @ohos/linphone ====================
  - id: "@ohos/linphone"
    name: "@ohos/linphone"
    type: "@ohos/linphone"
    confidence: 0.95
    fileRules:
      - type: "filename"
        patterns: ["liblinphone\\.so$", "libbelle-sip\\.so$", "libmediastreamer2\\.so$", "libohos_linphone\\.so$", "libbctoolbox\\.so$", "libbelr\\.so$", "libortp\\.so$"]

  # ==================== @ohos/lottie-turbo ====================
  - id: "@ohos/lottie-turbo"
    name: "@ohos/lottie-turbo"
    type: "@ohos/lottie-turbo"
    confidence: 0.95
    fileRules:
      - type: "filename"
        patterns: ["liblottie-turbo\\.so$"]

  # ==================== @tencent/mmkv ====================
  - id: "@tencent/mmkv"
    name: "@tencent/mmkv"
    type: "@tencent/mmkv"
    confidence: 0.95
    fileRules:
      - type: "filename"
        patterns: ["libmmkv\\.so$"]

  # ==================== @ohos/mp4parser ====================
  - id: "@ohos/mp4parser"
    name: "@ohos/mp4parser"
    type: "@ohos/mp4parser"
    confidence: 0.95
    fileRules:
      - type: "filename"
        patterns: ["libmp4parser_napi\\.so$"]

   # ==================== @ohos/vap ====================
  - id: "@ohos/vap"
    name: "@ohos/vap"
    type: "@ohos/vap"
    confidence: 0.95
    fileRules:
      - type: "filename"
        patterns: ["libvap\\.so$"]

  - id: '@hw-agconnect/hmcore'
    name: '@hw-agconnect/hmcore'
    type: '@hw-agconnect/hmcore'
    confidence: 0.95
    fileRules:
      - type: filename
        patterns:
          - "libagccrypto\\.so$"
          - "libagcmbedtls\\.so$"

  - id: '@kuiklybase/knoi'
    name: '@kuiklybase/knoi'
    type: '@kuiklybase/knoi'
    confidence: 0.95
    fileRules:
      - type: filename
        patterns:
          - "libknoi\\.so$"

  - id: '@mysoft/archive'
    name: '@mysoft/archive'
    type: '@mysoft/archive'
    confidence: 0.95
    fileRules:
    - type: filename
      patterns:
          - "libarchive\\.so$"
          - "libmyarchive\\.so$"

  - id: '@tencentyun/libiotvideo'
    name: '@tencentyun/libiotvideo'
    type: '@tencentyun/libiotvideo'
    confidence: 0.95
    fileRules:
      - type: filename
        patterns:
          - "liblibiotvideo\\.so$"

  - id: '@volcengine/apmplus'
    name: '@volcengine/apmplus'
    type: '@volcengine/apmplus'
    confidence: 0.95
    fileRules:
      - type: filename
        patterns:
          - "libnpth\\.so$"

  - id: '@wolfx/untar'
    name: '@wolfx/untar'
    type: '@wolfx/untar'
    confidence: 0.95
    fileRules:
      - type: filename
        patterns:
          - "libboundscheck\\.so$"
          - "libctar\\.so$"
          - "libtar\\.so$"

  - id: '@ohos/ijkplayer'
    name: '@ohos/ijkplayer'
    type: '@ohos/ijkplayer'
    confidence: 0.95
    fileRules:
    - type: filename
      patterns:
        - "libijkplayer\\.so$"
        - "libijkplayer_audio_napi\\.so$"
        - "libijkplayer_napi\\.so$"
        - "libijksdl\\.so$"
          

  - id: '@zaiohos/ijkplayer-surface'
    name: '@zaiohos/ijkplayer-surface'
    type: '@zaiohos/ijkplayer-surface'
    confidence: 0.95
    fileRules:
    - type: filename
      patterns:
        - "libijkplayer_surface_napi\\.so$"

  - id: jlreader
    name: jlreader
    type: jlreader
    confidence: 0.95
    fileRules:
      - type: filename
        patterns:
          - "libjlreader\\.so$"

  - id: ksadsdk
    name: ksadsdk
    type: ksadsdk
    confidence: 0.95
    fileRules:
      - type: filename
        patterns:
          - "libksadsdk\\.so$"
          - "libkwai-v8-lite\\.so$"

  - id: '@ohos/aki'
    name: '@ohos/aki'
    type: '@ohos/aki'
    confidence: 0.95
    fileRules:
      - type: filename
        patterns:
          - "libaki\\.so$"
          - "libaki_jsbind\\.so$"

  - id: rapid_kit
    name: rapid_kit
    type: rapid_kit
    confidence: 0.95
    fileRules:
      - type: filename
        patterns:
          - "libPPCS\\.so$"
          - "libRapidCore\\.so$"
          - "libRapidMedia\\.so$"
          - "libRapidSDL\\.so$"
          - "libnative_rapid_kit\\.so$"

  - id: shiply
    name: shiply
    type: shiply
    confidence: 0.95
    fileRules:
      - type: filename
        patterns:
          - "libshiply\\.so$"