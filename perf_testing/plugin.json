{
  "id": "perf_testing",
  "name": "负载测试",
  "description": "执行性能测试，收集性能数据和trace信息",
  "version": "1.0.0",
  "author": "HapRay Team",
  "execution": {
    "debug": {
      "cmd": ["python", "scripts/main.py"],
      "script": "scripts/main.py"
    },
    "release": {
      "cmd": ["perf-testing", "perf-testing.exe", "dist/perf-testing/perf-testing.exe", "dist/perf-testing/perf-testing"]
    }
  },
  "actions": {
    "perf": {
      "name": "自动化性能测试",
      "description": "执行性能测试，收集性能数据和trace信息",
      "action_mapping": {
        "type": "position"
      },
      "parameters": {
        "so_dir": {
          "type": "dir",
          "label": "SO文件目录",
          "required": false,
          "help": "符号化后的.so文件目录"
        },
        "run_testcases": {
          "type": "choice",
          "label": "测试用例",
          "required": false,
          "multi_select": true,
          "choices": "get_testcases",
          "help": "要运行的测试用例（支持多选）"
        },
        "round": {
          "type": "int",
          "label": "测试轮数",
          "required": false,
          "default": 5,
          "help": "测试执行的轮数"
        },
        "trace": {
          "type": "bool",
          "label": "Trace捕获",
          "required": false,
          "default": true,
          "help": "启用trace捕获"
        },
        "perf": {
          "type": "bool",
          "label": "Perf捕获",
          "required": false,
          "default": true,
          "help": "启用perf捕获"
        },
        "memory": {
          "type": "bool",
          "label": "内存捕获",
          "required": false,
          "default": false,
          "help": "启用内存分析"
        },
        "snapshot": {
          "type": "bool",
          "label": "Snapshot捕获",
          "required": false,
          "default": false,
          "help": "启用Snapshot捕获"
        },
        "devices": {
          "type": "str",
          "label": "设备序列号",
          "required": false,
          "nargs": "+",
          "help": "设备序列号（支持多个值）"
        },
        "hapflow": {
          "type": "dir",
          "label": "HapFlow目录",
          "required": false,
          "help": "启用HapFlow管道并指定Homecheck根目录"
        }
      }
    },
    "manual": {
      "name": "手动性能测试",
      "description": "手动性能测试模式，交互式收集性能数据",
      "action_mapping": {
        "type": "map",
        "command": ["perf", "--manual"]
      },
      "parameters": {
        "package-name": {
          "type": "choice",
          "label": "应用包名",
          "required": true,
          "choices": "get_installed_apps",
          "help": "目标应用包名（从设备已安装应用列表中选择）"
        },
        "so_dir": {
          "type": "dir",
          "label": "SO文件目录",
          "required": false,
          "help": "符号化后的.so文件目录"
        },
        "trace": {
          "type": "bool",
          "label": "Trace捕获",
          "required": false,
          "default": true,
          "help": "启用trace捕获"
        },
        "perf": {
          "type": "bool",
          "label": "Perf捕获",
          "required": false,
          "default": true,
          "help": "启用perf捕获"
        },
        "memory": {
          "type": "bool",
          "label": "内存捕获",
          "required": false,
          "default": false,
          "help": "启用内存分析"
        },
        "snapshot": {
          "type": "bool",
          "label": "Snapshot捕获",
          "required": false,
          "default": false,
          "help": "启用Snapshot捕获"
        },
        "round": {
          "type": "int",
          "label": "测试轮数",
          "required": false,
          "default": 1,
          "help": "测试执行的轮数"
        }
      }
    },
    "ui-tech-stack": {
      "name": "页面技术栈动态识别",
      "description": "页面技术栈动态识别模式，自动分析UI技术栈",
      "action_mapping": {
        "type": "map",
        "command": ["perf", "--ui-tech-stack"]
      },
      "parameters": {
        "so_dir": {
          "type": "dir",
          "label": "SO文件目录",
          "required": false,
          "help": "符号化后的.so文件目录"
        },
        "trace": {
          "type": "bool",
          "label": "Trace捕获",
          "required": false,
          "default": true,
          "help": "启用trace捕获"
        },
        "perf": {
          "type": "bool",
          "label": "Perf捕获",
          "required": false,
          "default": true,
          "help": "启用perf捕获"
        },
        "memory": {
          "type": "bool",
          "label": "内存捕获",
          "required": false,
          "default": false,
          "help": "启用内存分析"
        },
        "snapshot": {
          "type": "bool",
          "label": "Snapshot捕获",
          "required": false,
          "default": false,
          "help": "启用Snapshot捕获"
        },
        "round": {
          "type": "int",
          "label": "测试轮数",
          "required": false,
          "default": 1,
          "help": "测试执行的轮数"
        }
      }
    },
    "prepare": {
      "name": "用例前置条件配置",
      "description": "简化的测试执行，不生成复杂报告",
      "action_mapping": {
        "type": "position"
      },
      "parameters": {
        "run_testcases": {
          "type": "choice",
          "label": "测试用例",
          "required": false,
          "multi_select": true,
          "choices": "get_testcases",
          "help": "要运行的测试用例（支持多选）"
        },
        "all_0000": {
          "type": "bool",
          "label": "执行所有_0000用例",
          "required": false,
          "default": false,
          "help": "执行所有以_0000结尾的测试用例"
        },
        "device": {
          "type": "str",
          "label": "设备序列号",
          "required": false,
          "help": "设备序列号（如：HX1234567890）"
        }
      }
    },
    "update": {
      "name": "更新测试报告",
      "description": "更新现有测试性能报告",
      "action_mapping": {
        "type": "position"
      },
      "parameters": {
        "report_dir": {
          "type": "dir",
          "label": "报告目录",
          "required": true,
          "short": "r",
          "help": "包含要更新的报告的目录"
        },
        "so_dir": {
          "type": "dir",
          "label": "SO文件目录",
          "required": false,
          "help": "更新后的符号化.so文件目录"
        },
        "mode": {
          "type": "int",
          "label": "模式",
          "required": false,
          "default": 0,
          "help": "选择模式：0 COMMUNITY, 1 SIMPLE"
        },
        "perfs": {
          "type": "file",
          "label": "Perf数据路径",
          "required": false,
          "help": "SIMPLE模式需要的perf数据文件（支持多个文件）"
        },
        "traces": {
          "type": "file",
          "label": "Trace文件路径",
          "required": false,
          "help": "SIMPLE模式可选的trace文件（支持多个文件）"
        },
        "package-name": {
          "type": "str",
          "label": "应用包名",
          "required": false,
          "help": "SIMPLE模式需要的应用包名（单个包名字符串）"
        },
        "pids": {
          "type": "int",
          "label": "进程ID",
          "required": false,
          "nargs": "+",
          "help": "SIMPLE模式可选的进程ID列表"
        },
        "steps": {
          "type": "file",
          "label": "Steps文件",
          "required": false,
          "help": "SIMPLE模式可选的steps.json文件路径"
        },
        "time-ranges": {
          "type": "str",
          "label": "时间范围",
          "required": false,
          "nargs": "*",
          "help": "时间范围过滤器，格式为 \"startTime-endTime\"（纳秒），支持多个范围"
        },
        "hapflow": {
          "type": "dir",
          "label": "HapFlow目录",
          "required": false,
          "help": "运行HapFlow后处理，使用提供的Homecheck项目根目录"
        },
        "symbol-statistic": {
          "type": "str",
          "label": "SymbolsStatistic文件目录",
          "required": false,
          "help": "SymbolsStatistic.txt文件路径"
        }
      }
    },
    "compare": {
      "name": "对比报告",
      "description": "对比两个报告目录",
      "action_mapping": {
        "type": "position"
      },
      "parameters": {
        "base_dir": {
          "type": "dir",
          "label": "基准报告目录",
          "required": true,
          "help": "包含基准报告的目录"
        },
        "compare_dir": {
          "type": "dir",
          "label": "对比报告目录",
          "required": true,
          "help": "包含要对比报告的目录"
        },
        "output": {
          "type": "file",
          "label": "输出文件",
          "required": false,
          "default": "compare_result.xlsx",
          "help": "输出Excel文件路径（默认：当前目录下的compare_result.xlsx）"
        }
      }
    },
    "ui-compare": {
      "name": "UI组件树对比",
      "description": "对比两个报告的UI组件树",
      "action_mapping": {
        "type": "position"
      },
      "parameters": {
        "base_dir": {
          "type": "dir",
          "label": "基准报告目录",
          "required": true,
          "help": "基准报告根目录（如：PerfLoad_meituan_0010）"
        },
        "compare_dir": {
          "type": "dir",
          "label": "对比报告目录",
          "required": true,
          "help": "对比报告根目录（如：PerfLoad_meituan_0010）"
        },
        "output": {
          "type": "dir",
          "label": "输出目录",
          "required": false,
          "default": "./ui_compare_output",
          "short": "o",
          "help": "输出目录（默认：./ui_compare_output）"
        }
      }
    },
    "hilog": {
      "name": "hilog分析",
      "description": "hilog日志分析，分析图片解码参数。",
      "action_mapping": {
        "type": "position"
      },
      "parameters": {
        "hilog-dir": {
          "type": "dir",
          "label": "基准报告目录",
          "required": true,
          "help": "基准报告根目录（如：PerfLoad_meituan_0010）"
        },
        "output": {
          "type": "file",
          "label": "输出表格文件",
          "required": false,
          "default": "hilog_analysis.xlsx",
          "short": "o",
          "help": "输出表格文件（默认：hilog_analysis.xlsx）"
        },
        "detail": {
          "type": "bool",
          "label": "详细模式",
          "required": false,
          "default": false,
          "help": "开启详细模式：将匹配到的字符串保存到 hilog_detail.json 文件中"
        }
      }
    },
    "gui-agent": {
      "name": "GUI Agent自动化",
      "description": "使用LLM驱动的Agent进行手机自动化操作",
      "action_mapping": {
        "type": "position"
      },
      "parameters": {
        "max-steps": {
          "type": "int",
          "label": "最大步数",
          "required": false,
          "default": 20,
          "help": "每个任务的最大执行步数（默认: 20）"
        },
        "device-id": {
          "type": "str",
          "label": "设备ID",
          "required": false,
          "help": "多设备环境下的设备ID"
        },
        "apps": {
          "type": "str",
          "label": "应用包名",
          "required": true,
          "help": "要执行测试的多个应用包名，支持多个值"
        },
        "scenes": {
          "type": "str",
          "label": "多个场景",
          "required": false,
          "nargs": "+",
          "help": "要执行的多个场景（自然语言描述），支持多个值"
        },
        
        "output": {
          "type": "dir",
          "label": "输出目录",
          "required": false,
          "short": "o",
          "help": "保存步骤数据的路径（格式: output / 应用名 / 任务名）"
        },
        "trace": {
          "type": "bool",
          "label": "Trace捕获",
          "required": false,
          "default": true,
          "help": "启用trace捕获"
        },
        "perf": {
          "type": "bool",
          "label": "Perf捕获",
          "required": false,
          "default": true,
          "help": "启用perf捕获"
        },
        "memory": {
          "type": "bool",
          "label": "内存捕获",
          "required": false,
          "default": false,
          "help": "启用内存分析"
        },
        "snapshot": {
          "type": "bool",
          "label": "Snapshot捕获",
          "required": false,
          "default": false,
          "help": "启用Snapshot捕获"
        }
      }
    }
  },
  "config": {
    "description": "负载测试插件配置项",
    "items": {
      "glm_api_key": {
        "type": "str",
        "label": "GUI LLM API Key",
        "default": "",
        "help": "GUI LLM API Key",
        "required": false
      },
      "glm_base_url": {
        "type": "str",
        "label": "GUI LLM Base URL",
        "default": "http://localhost:8000/v1",
        "help": "GUI LLM Base URL",
        "required": false
      },
      "glm_model": {
        "type": "str",
        "label": "GUI LLM Model",
        "default": "autoglm-phone-9b",
        "help": "GUI LLM Model",
        "required": false
      },
      "logger_level": {
        "type": "choice",
        "label": "日志级别",
        "default": "INFO",
        "choices": ["DEBUG", "INFO", "WARNING", "ERROR"],
        "help": "日志输出级别",
        "required": false
      }
    }
  }
}
